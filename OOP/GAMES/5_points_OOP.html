<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<style>
        #game {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            table-layout: fixed;
        }

        #game > div {
            display: flex;
        }

        #game > div > div {
            width: 20px;
            height: 20px;
            /*margin: 0.5px;*/
            border: 1px solid #edecec;
        }

        .player1 {
            background: tomato;
            border-radius: 50%;
        }

        .player2 {
            background: #02fbf7;
            border-radius: 50%;
        }

        .field {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            text-align: center;
            align-items: center;
            text-shadow: black -2px -3px 5px;
            color: rgb(255, 255, 255);
            font-size: 5em;
            font-weight: bold;
            background-color: rgba(0, 0, 0, 0.27)
        }

        .button {
            margin-bottom: 40px;
            font-size: 18px;
            background: #004351;
            color: white;
            text-shadow: black 4px 5px 2px;
            padding: 10px 20px;
            border-radius: 9px;
            box-shadow: white 0 0 15px;
        }

        .button:hover {
            background: repeating-linear-gradient(203deg, #f42900, #5cf9f9 50%, rgb(249, 24, 0));
        }
	</style>
	<title>five points OOP</title>
</head>
<body>
<div id="game"></div>
<script>
 
	class Field {
	    constructor(dom) {
	        this._dom = document.querySelector(dom);
	        this._rNum = Math.floor(window.innerHeight / 23);
	        this._cNum = Math.floor(window.innerWidth / 22);
	        this._field = Array.from({length: this._rNum}, () => Array.from({length: this._cNum}, () => 0));
	        this.draw();
        }
        
        draw(){
	        this._field.forEach((el, i) => {
	            let div = document.createElement('div');
	            el.forEach((e, k) => {
	                let div2 = document.createElement('div');
	                div2.dataset.xy = `${k},${i}`;
	                div.appendChild(div2);
				})
				this._dom.appendChild(div);
			})
   
		}
		
    }
    
    
    class Listener {
	    constructor() {
	        this.field = new Field('#game');
	        this.element = {};
	        this.player = new Players('player1','player2', 'player3');
	        this.point();
        }

        point() {
	        this.field._dom.addEventListener('click', el=> {
	            el.target.classList = this.player.getPlayers();
	            this.element = el.target;
                new Checker(this.element);
        	});
	    }
	    
	}
	
	
	class Checker {
	    constructor(element) {
	        this.element = element;
	        this._columns = Math.floor(window.innerWidth / 22);
	        this._rows = Math.floor(window.innerHeight / 23);
	        this.clmn = Array(9).fill([0,-4]).map(([x,y], i) => [x, y+i]);
	        this.rows = Array(9).fill([-4,0]).map(([x,y], i) => [x+i, y]);
	        this.diagl = Array(9).fill([-4,-4]).map(([x,y], i) => [x+i, y+i]);
	        this.diagr = Array(9).fill([4,-4]).map(([x,y], i) => [x-i, y+i]);
			this.coordinats = this.element.dataset.xy.split(',').map(Number);
			this.player = this.element.classList[0]
			
            this.check(this.clmn, this.player);
            this.check(this.rows, this.player);
            this.check(this.diagl, this.player);
            this.check(this.diagr, this.player);
        }

        createArr(arr, player) {
            let xy = this.coordinats;
            const temp = []
            for(let i of arr){
                if(xy[0]- i[0] > - 1 && xy[1] - i[1] > - 1 && xy[0] - i[0] < this._columns && xy[1] - i[1] < this._rows){
                    temp.push([xy[0] - i[0], xy[1] - i[1]]);
				}
			}
            return temp.map( ([x,y])=> document.querySelector(`[data-xy='${x},${y}']`).classList[0] || '$$$').join('').includes(player.repeat(5));
        }
        
        check(arr, player) {
            if ( this.createArr(arr, player) ){
                new Restart(player);
			}
        }
    }
    
    
    class Restart {
	    constructor(winner) {
	        this.body = document.querySelector('body');
	        this.winner = winner;
	        this.popUp();
        }
        
        popUp(){
            let div = document.createElement('div');
            div.className = 'field';
            div.innerText = 'GAME OVER\n' + this.winner + ' wins !';
            this.body.appendChild(div);
            let button = document.createElement('button');
            button.innerHTML = 'RESTART';
            button.className = 'button';
            div.appendChild(button);
            button.addEventListener('click', () => location.reload());
		}
    }
    
    
    class Players{
	    constructor(...players) {
	        this.data = players;
	        this.count = new Counter(this.data.length-1)
        }
        
        getPlayers(){
	        return this.data[this.count.get()]
		}
	}
	
	class Counter{
	    constructor(length) {
	        this._length = length;
	        this._counter = -1;
        }
        get(){
	        if (this._counter < this._length){
	            this._counter++;
			}else{
	            this._counter = 0;
			}
	        return this._counter
		}
	}
    
	
	new Listener().point();
	//let players = new Players('player1','player2', 'player3')

    //setInterval(()=> console.log(new Players('player1','player2', 'player3').getPlayers()), 3000)
	//setInterval(()=> console.log(new Checker(listen.element).check()), 3000);
	
	
	
	// game._dom.addEventListener('click', el=> {
	//     console.log( el.target.dataset.xy.split(',').map(Number) )
	// })
	
</script>
</body>
</html>