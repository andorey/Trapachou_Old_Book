<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>the pixel picture and rotate</title>
</head>
<style>
	body{
        display: flex;
		flex-direction: column;
        justify-content: center;
        justify-items: center;
        align-items: center;
	}
	
    .rotates {
        display: flex;
        justify-content: center;
        justify-items: center;
        align-items: center;
        margin: 10px;
        font-size: 1.2em;
        font-family: Verdana monospace;
    }

    .button, .active,
	#cangeColor{
        font-size: 0.9em;
        padding: 1px;
        margin: 0 20px 10px 10px;
    }

    #buttons {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    td, tr, table {
        border: solid gray 0.5px;
    }

    section {
        width: 451px;
        display: flex;
        flex-wrap: wrap;
    }
	section>div{
		width: 3px;
		height: 3px;
		/*border: black dotted 0.01px;*/
	}
</style>
<body>
<div> The Pixel Picture :</div>
<section ></section>

<div class="rotates">
	<div>Origin image :</div>
	<img src="skeleton.png" alt="dollar" height="150" width="150">
	<div id="buttons">
		<label>
			<input type="button" class="button" value="Copy">
		</label>
		<label>
			<input type="button" class="active" value="Rotate">
		</label>
		<label><input type="button" id="cangeColor" value="Change Color"></label>
	</div>
	<div>The image to canvas âžœ :</div>
	<canvas id="canvas" width="150" height="150" style="color: #eeeeee"></canvas>
</div>

<script>
    window.addEventListener('load', function() {
        const canvas = document.querySelector('canvas');
        const ctx = canvas.getContext('2d');
        let img = document.querySelector('img');
        let button = document.querySelector('.button');
        let buttonActive = document.querySelector('.active');
        let colourlist = document.querySelector('section');
        let angel = 15

        let imgWidth = img.offsetWidth;
        let imgHeight = img.offsetHeight;

        canvas.height = 0;


		function cangeColor() {
            let pixels = ctx.getImageData(0, 0, canvas.width, canvas.height);

            let all = pixels.data.length;
            let data = pixels.data;
            for (let i = 0; i < all;i += 4) {
                let stash = data[i];
                data[i] = data[i+1];
                data[i+1] = stash;
            }
            ctx.putImageData(pixels, 0, 0);
            canvas.style.display = 'inline';
        }
        

        buttonActive.addEventListener('click', function () {
            canvas.width = imgWidth;
            canvas.height = imgHeight;

            document.querySelector('#cangeColor').addEventListener('click', cangeColor, false)
            
            ctx.save();
            ctx.translate(imgWidth / 2, imgHeight / 2);
            ctx.rotate(angel * Math.PI / 180);
            ctx.shadowOffsetX = 7;
            ctx.shadowOffsetY = 7;
            ctx.shadowBlur = 4;
            ctx.shadowColor = 'rgba(63,62,62,0.5)';
            ctx.drawImage(
                img, -(imgWidth / 2), -(imgHeight / 2)
            );
            ctx.restore();
            angel += 15;
        });

        button.addEventListener('click', function () {
            canvas.width = imgWidth;
            canvas.height = imgHeight;

            ctx.shadowOffsetX = 7;
            ctx.shadowOffsetY = 7;
            ctx.shadowBlur = 4;
            ctx.shadowColor = 'rgba(63,62,62,0.5)';
            ctx.drawImage(img, 0, 0);

            document.querySelector('#cangeColor').addEventListener('click', cangeColor, false)

            //let colours = {};
            let arr = [];
            let data = ctx.getImageData(0, 0, imgWidth, imgHeight).data;

            //canvas.style.display = 'none';
            let all = data.length;

            for (let i = 0; i < all; i += 4) {
                let key = `${data[i]}, ${data[i + 1]}, ${data[i + 2]}, ${data[i + 3]}`;
                arr.push(key);
            }

            /* //part of the function that builds the pixel grid
            for (let i = 0; i < all; i += 4) {
                let key = `${data[i]}, ${data[i + 1]}, ${data[i + 2]}, ${data[i + 3]}`;
                if (colours[key]) {
                    colours[key]++;
                } else {
                    colours[key] = 1;
                }
            }

            let sortedcolours = Object.keys(colours).filter(el => colours[el] > 1).sort(
                function (a, b) {
                    return colours[b] - colours[a];
                }
            );
			*/

            for (let step of arr) {
                let div = document.createElement('div')
                let indx = step.split(',')
                div.style.background = `rgba(${+indx[0]}, ${+indx[1]}, ${+indx[2]}, ${+indx[3]})`
                colourlist.appendChild(div)
            }

        })
    });
	
</script>
</body>
</html>