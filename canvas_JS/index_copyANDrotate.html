<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>the pixel picture and rotate</title>
</head>
<style>
	body{
        display: flex;
		flex-direction: column;
        justify-content: center;
        justify-items: center;
        align-items: center;
	}
	
    .window {
        display: flex;
        justify-content: center;
        justify-items: center;
        align-items: center;
        margin: 10px;
        font-size: 1.2em;
        font-family: Verdana monospace;
    }

    .buttonCopy, .rotateRight,.rotateLeft,
	#changeColor, #changePhoto{
        font-size: 0.9em;
        padding: 1px;
        margin: 0 5px 5px 5px;
    }

    #buttons {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    td, tr, table {
        border: solid gray 0.5px;
    }

    section {
        width: 451px;
        display: flex;
        flex-wrap: wrap;
    }
	section>div{
		width: 3px;
		height: 3px;
		/*border: black dotted 0.01px;*/
	}
</style>
<body>
<div> The Pixel Picture :</div>
<section ></section>

<div class="window">
	<div>Origin image :</div>
	<img src="skeleton.png" alt="dollar" height="150" width="150">
	<div id="buttons">
		<label>
			<input type="button" class="buttonCopy" value="Copy">
		</label>
		<div>
			<label>
				<input type="button" class="rotateLeft" value="<">
			</label>
			<label>
				<input type="button" class="rotateRight" value=">">
			</label>
		</div>
		<label>
			<input type="button" id="changeColor" value="Change Color">
		</label>
		<label>
			<input type="button" id="changePhoto" value="Make Photo">
		</label>
	</div>
	<div>The image to canvas âžœ :</div>
	<canvas id="canvas" width="150" height="150" style="color: #eeeeee"></canvas>
</div>

<script>
    window.addEventListener('load', function() {
        const canvas = document.querySelector('canvas');
        const ctx = canvas.getContext('2d');
        let img = document.querySelector('img');
        let buttonCopy = document.querySelector('.buttonCopy');
        let rotateRight = document.querySelector('.rotateRight');
        let rotateLeft = document.querySelector('.rotateLeft');
        let colourlist = document.querySelector('section');
        let angle = 0

        let imgWidth = img.offsetWidth;
        let imgHeight = img.offsetHeight;

        canvas.height = 0;

        buttonCopy.addEventListener('click', function () {
            buttonCopy.disabled = true;
            
            canvas.width = imgWidth;
            canvas.height = imgHeight;

            ctx.shadowOffsetX = 7;
            ctx.shadowOffsetY = 7;
            ctx.shadowBlur = 4;
            ctx.shadowColor = 'rgba(63,62,62,0.5)';
            ctx.drawImage(img, 0, 0);

			document.getElementById('changeColor').addEventListener('click', function() {
                let pixels = ctx.getImageData(0, 0, canvas.width, canvas.height);

                let all = pixels.data.length;
                let data = pixels.data;
                for (let i = 0; i < all;i += 4) {
                    let stash = data[i];
                    data[i] = data[i+1];
                    data[i+1] = stash;
                }
                ctx.putImageData(pixels, 0, 0);
                canvas.style.display = 'inline';
            })
			
			document.getElementById('changePhoto').addEventListener('click', function () {
                let arr = [];
                let data = ctx.getImageData(0, 0, imgWidth, imgHeight).data;
				
                let all = data.length;

                for (let i = 0; i < all; i += 4) {
                    let key = `${data[i]}, ${data[i + 1]}, ${data[i + 2]}, ${data[i + 3]}`;
                    arr.push(key);
                }
			    
                for (let step of arr) {
                    let div = document.createElement('div')
                    let indx = step.split(',')
                    div.style.background = `rgba(${+indx[0]}, ${+indx[1]}, ${+indx[2]}, ${+indx[3]})`
                    colourlist.appendChild(div)
                }
            });

            rotateRight.addEventListener('click', function () {
                angle += 15;
                
                canvas.width = imgWidth;
                canvas.height = imgHeight;
				
                ctx.save();
                ctx.translate(imgWidth / 2, imgHeight / 2);
                ctx.rotate(angle * Math.PI / 180);
                ctx.shadowOffsetX = 7;
                ctx.shadowOffsetY = 7;
                ctx.shadowBlur = 4;
                ctx.shadowColor = 'rgba(63,62,62,0.5)';
                ctx.drawImage(
                    img, -(imgWidth / 2), -(imgHeight / 2)
                );
                ctx.restore();
            });

            rotateLeft.addEventListener('click', function () {
                angle -= 15;
                canvas.width = imgWidth;
                canvas.height = imgHeight;
				
                ctx.save();
                ctx.translate(imgWidth / 2, imgHeight / 2);
                ctx.rotate(angle * Math.PI / 180);
                ctx.shadowOffsetX = 7;
                ctx.shadowOffsetY = 7;
                ctx.shadowBlur = 4;
                ctx.shadowColor = 'rgba(63,62,62,0.5)';
                ctx.drawImage(
                    img, -(imgWidth / 2), -(imgHeight / 2)
                );
                ctx.restore();
            });

        })
    });
	
</script>
</body>
</html>